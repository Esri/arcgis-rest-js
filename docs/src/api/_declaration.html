{% macro @paramType(type) -%}
  <i>{%- if type.type === 'intrinsic' -%}
      {{type.name}}
    {%- endif -%}

    {%- if type.type === 'reference' and type.id -%}
      <a href="{{ API_TOOLS.findById(data.typedoc, type.id).pageUrl }}">{{type.name}}</a>
    {%- elif type.type === 'reference' -%}
      {{type.name}}
    {%- endif -%}

    {%- if type.type === 'reflection' and type.declaration.id -%}
      {% set declaration = API_TOOLS.findById(data.typedoc, type.declaration.id)%}
      <a href="{{ declaration.pageUrl }}">{{declaration.name}}</a>
    {%- elif type.type === 'reflection' -%}
      {{type.name}}
    {%- endif -%}

    {%- if type.type === 'union' -%}
      {% for t in type.types -%}
        {%- if t.type === 'stringLiteral' -%}
          <code>"{{t.value}}"</code>
        {% else %}
          <code>{{t.value}}</code>
        {%- endif -%}
      {%- endfor %}
    {%- endif -%}

    {%- if type.typeArguments -%}
      {% for arg in type.typeArguments -%}
        {{ '<' if loop.first}}{{ @paramType(arg) }}{{ '>' if loop.last}}
      {%- endfor %}
    {%- endif -%}</i>
{%- endmacro %}

{% macro @param(param) -%}
  {{param.name}}: {{@paramType(param.type)}}
{%- endmacro %}

{% macro @signatureParams(params) -%}
  {% for param in params -%}{{ @param(param) }}{{ ', ' if (loop.last === false)}}{%- endfor %}
{%- endmacro %}

{% macro @signature(signature) -%}
  <li class="code-face tsd-signature tsd-kind-icon">{{ signature.name }}({{ @signatureParams(signature.parameters) }}) : {{@paramType(signature.type)}}</li>
{%- endmacro %}

{% macro @properties (group, children) %}
  <table>
    <thead>
      <tr>
        <th>{{ API_TOOLS.findChildById(group.children[0], children).kindString }}</th>
        <th>{{ 'Value' if group.children[0].defaultValue else 'Type' }}</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody>
      {% for id in group.children %}
        {% set child = API_TOOLS.findChildById(id, children) %}
        <tr>
          <td class="code-face {{child.icon}} no-wrap">
            <span class="tsd-kind-icon">{{child.name}}</span>
            {{ @flags(child.flags) }}
          </td>
          <td class="code-face">
            {% if child.defaultValue %}
              {{ child.defaultValue }}
            {% elif child.getSignature %}
              {{ @paramType(child.getSignature[0].type) }}
            {% else %}
              {{ @paramType(child.type) }}
            {% endif %}
          </td>
          <td class="body-face api-param-comment">
            {% markdown -%}
              {{ child.comment.shortText | safe | trim }}
            {%- endmarkdown %}
          </td>
        </tr>
      {% endfor %}

    </tbody>
  </table>
{% endmacro %}

{% macro @flags(flags) %}
  {% if flags.isOptional %}
  <span class="label">Optional</span>
  {% endif %}

  {% if flags.isPrivate %}
  <span class="label">Private</span>
  {% endif %}

  {% if flags.isProtected %}
  <span class="label">Protected</span>
  {% endif %}

  {% if flags.isRequired %}
  <span class="label">Required</span>
  {% endif %}

  {% if flags.isStatic %}
  <span class="label">Static</span>
  {% endif %}
{% endmacro %}

{% macro @signatures(signatures) %}
 {% markdown -%}
    {{ signatures[0].comment.shortText | safe }}
  {%- endmarkdown %}

  <ul class="list-plain tsd-signatures {{icon}} trailer-half">
    {% for signature in signatures %}
      {{ @signature(signature) }}
    {% endfor %}
  </ul>

  <h2 class="font-size-1 trailer-half">Parameters</h2>
  {{@parametersTable(signatures[0].parameters)}}

  <h2 class="font-size-1 trailer-half">Returns</h2>

  {%- markdown -%}
    <code>{{@paramType(signatures[0].type)}}</code>{{" - " if signatures[0].comment.returns}}{{ signatures[0].comment.returns | safe }}
  {%- endmarkdown %}

  {% if signatures[0].comment.text %}
    <hr class="leader-half trailer-half">

    {% markdown -%}
      {{ signatures[0].comment.text | safe }}
    {%- endmarkdown %}
  {% endif %}
{% endmacro %}

{% macro @methodsTable(group, children) %}
  <table>
    <thead>
    <tr>
      <th>Method</th>
      <th>Returns</th>
      <th>Notes</th>
    </tr>
    </thead>
    <tbody>
      {% for childId in group.children %}
        {% set child = API_TOOLS.findChildById(childId, children) %}
        <tr>
          <td>
            <ul class="method-table-signatures {{child.signatures[0].icon}}">
              {% for signature in child.signatures %}
                <li class="code-face tsd-signature tsd-kind-icon"><a href="#{{signature.name}}">{{ signature.name }}</a>({{ @signatureParams(signature.parameters) }})</li>
              {% endfor %}
            </ul>
          </td>
          <td>{{@paramType(child.signatures[0].type)}}</td>
          <td class="body-face api-param-comment">
            {% markdown -%}
              {{ child.signatures[0].comment.shortText | safe | trim }}
            {%- endmarkdown %}
            {% markdown -%}
              {{ child.signatures[0].comment.text | safe | trim }}
            {%- endmarkdown %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% for childId in group.children %}
    {% set child = API_TOOLS.findChildById(childId, children) %}
    {% set signatures = child.signatures %}
    <div class="panel panel-white padding-trailer-0 leader-1 trailer-1">
      <div class="clearfix">
        <h3 id="{{ signatures[0].name }}" class="font-size-2 code-face trailer-0 margin-right-half left">{{signatures[0].name}}</h3>
        {{ @flags(child.flags)}}
        <small class="{{signatures[0].icon}} font-size--2 right">
          <span class="tsd-kind-icon">
            {% if child.flags.isStatic %}
              Static {{kindString}} Method
            {% elif child.flags.isPrivate %}
              Private {{kindString}} Method
            {% elif child.flags.isProtected %}
              Protected {{kindString}} Method
            {% else %}
              {{kindString}} Method
            {% endif %}
          </span>
        </small>
      </div>

      <hr class="leader-half trailer-1">

      <div class="api-function-comment">
        {% markdown -%}
          {{ signatures[0].comment.shortText | safe }}
        {%- endmarkdown %}
      </div>

      <ul class="list-plain tsd-signatures trailer-half {{signatures[0].icon}}">
        {% for signature in signatures %}
          {{ @signature(signature) }}
        {% endfor %}
      </ul>

      <h2 class="font-size-1 trailer-half">Parameters</h2>
      {{@parametersTable(signatures[0].parameters)}}

      <h2 class="font-size-1 trailer-half">Returns</h2>

      {%- markdown -%}
        <code>{{@paramType(signatures[0].type)}}</code>{{" - " if signatures[0].comment.returns}}{{ signatures[0].comment.returns | safe }}
      {%- endmarkdown %}

      {% if signatures[0].comment.text %}
        <hr class="leader-half trailer-half">

        {% markdown -%}
          {{ signatures[0].comment.text | safe }}
        {%- endmarkdown %}
      {% endif %}
    </div>
  {% endfor %}
{% endmacro %}

{% macro @accessorsTable(group, children) %}
  {{ @properties(group, children) }}
  {# @TODO make a custom table when and if we need setters... #}
{% endmacro %}

{% macro @parametersTable(parameters) %}
  <div class="overflow-auto">
    <table>
      <thead>
        <tr>
          <th class="font-size--2">Parameter</th>
          <th class="font-size--2">Type</th>
          <th class="font-size--2">Default</th>
          <th class="font-size--2">Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for param in parameters -%}
          <tr>
            <td class="code-face">
              <span class="code-face">{{param.name}}</span>
              {% if param.defaultValue %}
                {{ @flags({isOptional: true}) }}
              {% elif not param.defaultValue and not param.flags.isOptional %}
                {{ @flags({isRequired: true}) }}
              {% else %}
                {{ @flags(param.flags) }}
              {% endif %}
            </td>
            <td class="code-face">{{@paramType(param.type)}}</td>
            <td class="code-face">{{param.defaultValue}}</td>
            <td class="body-face api-param-comment">
              {% markdown -%}
                {{ param.comment.shortText | safe | trim }}
              {%- endmarkdown %}
              {% markdown -%}
                {{ param.comment.text | safe | trim }}
              {%- endmarkdown %}
            </td>
          </tr>
        {%- endfor %}
      </tbody>
    </table>
  </div>
{% endmacro %}

<div class="clearfix">
  <h1 class="left font-size-5 code-face trailer-0">{{name}}</h1>
  <small class="{{icon}} font-size--2 right"><span class="tsd-kind-icon">{{kindString}}</span></small>
</div>

<hr class="leader-half trailer-1">

{% if comment %}
  {% markdown -%}
    {{ comment.shortText | safe }}
  {%- endmarkdown %}
{% endif %}

{% if type %}
  Value(s): {{@paramType(type)}}
{% endif %}

{% if groups %}
  {% for group in groups %}
    <h2 class="font-size-3">{{group.title}}</h2>

    {% if group.title == 'Properties' %}
      {{ @properties(group, children) }}
    {% endif %}

    {% if group.title == 'Constructors' %}
      {% set firstSignature = API_TOOLS.findChildById(group.children[0], children).signatures[0] %}
      <ul class="list-plain trailer-1 {{ API_TOOLS.findChildById(group.children[0], children).icon }}">
        {% for id in group.children %}
          {% set signatures = API_TOOLS.findChildById(id, children).signatures %}
          {% for signature in signatures %}
            {{ @signature(signature) }}
          {% endfor %}
        {% endfor %}
      </ul>

      <h2 class="font-size-1">Constructor Parameters</h2>
      {{@parametersTable(firstSignature.parameters)}}
    {% endif %}

    {% if group.title == 'Accessors' %}
      {{ @accessorsTable(group, children) }}
    {% endif %}

    {% if group.title == 'Methods' %}
      {{ @methodsTable(group, children) }}
    {% endif %}

  {% endfor %}
{% endif %}

{% if signatures %}
  {{@signatures(signatures)}}
{% endif %}

<hr class="leader-half trailer-half">

<small class="font-size--2">{{kindString}} defined in <a href="https://github.com/ArcGIS/rest-js/blob/master/packages/{{sources[0].fileName}}#L{{sources[0].line}}">packages/{{sources[0].fileName}}:{{sources[0].line}}</a></small>

<details class="leader-1">
  <summary>Debug Info</summary>
  <pre><code>{{__defaultMetadata | inspect}}</code></pre>
</details>
